//
//  MarketData.swift
//  SwiftyCrypto
//
//  Created by Vadym Boiko on 04.01.2022.
//

import Foundation

//JSON Data:
/*
 
 URL: https://api.coingecko.com/api/v3/global
 
 JSON Responce:
 
 {
   "data": {
     "active_cryptocurrencies": 12216,
     "upcoming_icos": 0,
     "ongoing_icos": 50,
     "ended_icos": 3375,
     "markets": 701,
     "total_market_cap": {
       "btc": 50607623.73772038,
       "eth": 618099998.4607903,
       "ltc": 15831521015.197672,
       "bch": 5460307676.562022,
       "bnb": 4617799088.39729,
       "eos": 736312897381.6842,
       "xrp": 2845664722166.8936,
       "xlm": 8354214456884.102,
       "link": 100337783956.12994,
       "dot": 80175535432.96733,
       "yfi": 61647118.84863042,
       "usd": 2371799810227.3276,
       "aed": 8711620702964.964,
       "ars": 244475390571811.84,
       "aud": 3275339319733.2407,
       "bdt": 203408205769083.4,
       "bhd": 894310836444.3154,
       "bmd": 2371799810227.3276,
       "brl": 13442649784425.418,
       "cad": 3009313509418.519,
       "chf": 2167760987952.9006,
       "clp": 2013966372858330.8,
       "cny": 15072313434032.629,
       "czk": 51651396007263.84,
       "dkk": 15597844976983.762,
       "eur": 2097171482000.9167,
       "gbp": 1750656273326.324,
       "hkd": 18486450478660.355,
       "huf": 760961294624490.9,
       "idr": 34010779148726324,
       "ils": 7318947290395.673,
       "inr": 176744719290284.9,
       "jpy": 275095572789026.72,
       "krw": 2838776525489543.5,
       "kwd": 717988866752.2063,
       "lkr": 480999934204187.4,
       "mmk": 4215432004643053,
       "mxn": 48584540262649.125,
       "myr": 9896334708173.535,
       "ngn": 978936653673228.9,
       "nok": 20972122769576.523,
       "nzd": 3480383785127.2046,
       "php": 121400570914685.97,
       "pkr": 418693820499430.3,
       "pln": 9575660258431.36,
       "rub": 178284396855091.7,
       "sar": 8907491046692.988,
       "sek": 21547801275915.266,
       "sgd": 3213551562877.007,
       "thb": 78825806113982.02,
       "try": 32058455852935.785,
       "twd": 65305140718399.01,
       "uah": 64707791077194.055,
       "vef": 237488314998.06247,
       "vnd": 53972006848921020,
       "zar": 37883876059231.71,
       "xdr": 1695222568161.6885,
       "xag": 103045641479.1021,
       "xau": 1306980285.4257705,
       "bits": 50607623737720.375,
       "sats": 5060762373772038
     },
     "total_volume": {
       "btc": 2112237.667939765,
       "eth": 25797972.773206554,
       "ltc": 660768725.3285528,
       "bch": 227899804.43951362,
       "bnb": 192735569.40830255,
       "eos": 30731888248.691704,
       "xrp": 118771042237.42023,
       "xlm": 348684351459.18616,
       "link": 4187852168.0474105,
       "dot": 3346329534.586073,
       "yfi": 2572999.025342147,
       "usd": 98993087008.75616,
       "aed": 363601608583.16095,
       "ars": 10203801141233.506,
       "aud": 136704602497.82895,
       "bdt": 8489757915135.299,
       "bhd": 37326333387.521576,
       "bmd": 98993087008.75616,
       "brl": 561063119239.527,
       "cad": 125601339872.75266,
       "chf": 90477008712.65387,
       "clp": 84057999971745.12,
       "cny": 629081269323.244,
       "czk": 2155802153715.7966,
       "dkk": 651015662577.2097,
       "eur": 87530776457.09935,
       "gbp": 73068084431.29407,
       "hkd": 771578947272.8246,
       "huf": 31760651689165.066,
       "idr": 1419526220125111.5,
       "ils": 305474847753.35913,
       "inr": 7376889609146.393,
       "jpy": 11481812189797.588,
       "krw": 118483545860165.28,
       "kwd": 29967088306.20365,
       "lkr": 20075753498486.594,
       "mmk": 175941757569804.66,
       "mxn": 2027799142559.1133,
       "myr": 413048655544.0356,
       "ngn": 40858406731994.09,
       "nok": 875324791381.9589,
       "nzd": 145262653862.82297,
       "php": 5066961059550.098,
       "pkr": 17475249649655.734,
       "pln": 399664493201.19025,
       "rub": 7441151961508.98,
       "sar": 371776754687.60596,
       "sek": 899352195474.5496,
       "sgd": 134125733588.16376,
       "thb": 3289995154535.7695,
       "try": 1338041050484.7234,
       "twd": 2725675855685.273,
       "uah": 2700743951756.676,
       "vef": 9912177802.186762,
       "vnd": 2252658739154014.5,
       "zar": 1581179753362.4956,
       "xdr": 70754418001.72531,
       "xag": 4300871476.938073,
       "xau": 54550140.59617516,
       "bits": 2112237667939.765,
       "sats": 211223766793976.5
     },
     "market_cap_percentage": {
       "btc": 37.385349484208454,
       "eth": 19.230168318098727,
       "bnb": 3.6395979688476396,
       "usdt": 3.273553783031192,
       "sol": 2.2331494030336274,
       "ada": 1.8014165687514196,
       "usdc": 1.7889037966754198,
       "xrp": 1.668633442050829,
       "dot": 1.3366818809417256,
       "luna": 1.3287038800003161
     },
     "market_cap_change_percentage_24h_usd": -0.15961715330898818,
     "updated_at": 1641312443
   }
 }
 
 
 */

struct GlobalData: Codable {
    let data: MarketData?
}

struct MarketData: Codable {

    let totalMarketCap, totalVolume, marketCapPercentage: [String: Double]
    let marketCapChangePercentage24HUsd: Double
    
    enum CodingKeys: String, CodingKey {
        case totalMarketCap = "total_market_cap"
        case totalVolume = "total_volume"
        case marketCapPercentage = "market_cap_percentage"
        case marketCapChangePercentage24HUsd = "market_cap_change_percentage_24h_usd"
    }
    
    var marketCap: String {
        if let item = totalMarketCap.first(where: { $0.key == "usd" }) {
            return "$" + item.value.formattedWithAbbreviations()
        }
        return ""
    }
    
    var volume: String {
        if let item = totalVolume.first(where: { $0.key == "usd" }) {
            return "$" + item.value.formattedWithAbbreviations()
        }
        return ""
    }
    
    var btcDominance: String {
        if let item = marketCapPercentage.first(where: { $0.key == "btc" }) {
            return item.value.asPercentString()
        }
        return ""
    }
    
}
